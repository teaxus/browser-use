---
test_name: "聊天功能测试"
environment: "test"
timeout: 600
retry_count: 3
---

# 聊天功能测试

## 测试元数据

- 作者: Test Agent 团队
- 日期: 2025-07-16

## 测试目标

验证用户通过手机号+验证码登录系统后，能正常进入「咨询互动」模块，与指定会话进行消息交互（包括发送预设消息、接收他人消息、根据退出条件终止交互），并确保聊天流程流畅。

## 测试步骤

### 步骤 1: 访问登录页面

- 打开浏览器访问 `${base_url}/#/login`
- 等待页面完全加载（页面标题应包含系统名称）

期望结果: 登录页面成功加载，页面中存在【手机登陆】按钮

### 步骤 2: 手机号+验证码登录

- 点击页面中的【手机登陆】按钮
- 在手机号输入框中输入 `${credentials.phone}`（需验证输入内容与 `${credentials.phone}` 完全一致）
- 在验证码输入框中输入 `${credentials.code}`（无需点击获取验证码）
- 点击页面中的【登录】按钮

期望结果: 登录成功，页面跳转至系统主页（需验证主页包含用户相关标识，如欢迎语或头像）

### 步骤 3: 筛选并进入「咨询互动」模块

- 在系统主页的筛选输入框（placeholder='请输入内容'）中输入"咨询互动"
- 等待系统响应后，在菜单栏中找到并点击【咨询互动】选项
- 验证是否在新浏览器 tab 中打开「咨询互动」页面（检查当前 tab 标题或 URL 变化）

期望结果: 成功在新 tab 打开「咨询互动」页面，页面显示主管在管的会话列表

### 步骤 4: 选择目标会话

- 在「咨询互动」页面中，定位到「主管在管」分类下的第一个会话（需验证会话列表加载完成）
- 点击该会话进入聊天界面

期望结果: 跳转至具体会话的聊天页面，页面显示历史聊天记录（若有）

### 步骤 5: 发送初始测试消息

- 定位聊天页面的消息输入框（通过 class="editor text-put" 的 div 元素）
- 点击输入框后输入"hello world"（需验证输入框实际内容与"hello world"完全一致，避免识别错误）
- 点击页面中的【发送】按钮

期望结果: 消息成功发送，聊天记录区域显示"hello world"（发送时间戳正常，无重复/丢失）

### 步骤 6: 等待并响应其他消息直至退出条件触发

- 以每 2 分钟为间隔，检查聊天记录区域的最新消息（需验证消息加载状态，避免漏读）
- 当接收到他人发送的消息时，随机生成回复内容（如测试相关的自然语言回复）并发送
- 持续重复上述操作，直到检测到最后一条消息内容为"exit"（需严格验证最后一条消息的文本内容，忽略历史消息）

期望结果:

- 能正常接收并响应他人发送的聊天消息（回复内容符合预期格式）
- 聊天交互过程流畅（消息发送/接收无明显延迟，无卡顿或丢失）
- 最终准确识别到最后一条消息为"exit"（验证消息顺序和内容正确性）

### 步骤 7: 验证退出条件终止交互（可选）

- 当检测到最后一条消息为"exit"后，停止发送新消息
- 观察聊天页面是否自动结束当前会话或提示交互终止（根据业务规则可选验证）

期望结果: 收到"exit"消息后，聊天交互自然终止（无后续强制消息推送）
